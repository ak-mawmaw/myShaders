<!DOCTYPE html>
<html>

<head>
	<title> Lambertian Shader!</title>
</head>

<body>
	<div id="container"></div>
	<script src="./three.js"></script>
	<script id="vertexShader" type="x-shader/x-vertex">

		varying vec4 globalNorm;
		varying vec4 globalPos;

		void main() {
			globalNorm = modelViewMatrix * (vec4(normal, 0));
			globalPos = modelViewMatrix * vec4(position, 1);
			gl_Position = projectionMatrix * globalPos;
		}

</script>
	<script id="fragmentShader" type="x-shader/x-fragment">
		varying vec4 globalNorm;
		varying vec4 globalPos;
		
		 
		void main(){
		
	

		//Lambertian diffuse component
			vec4 N = normalize(globalNorm);
			vec4 L = normalize((vec4(cameraPosition, 1) - globalPos));
			float cosine = dot(N,L);
			float k_lambert = max(cosine, 0.);
			vec3 lightColor = vec3(1., 0., 0.);
			vec3 lambertColor = (k_lambert * lightColor ) / (length(L) * length(L));

		//add in an ambient color
		vec3 ambientColor = vec3(0., 0.1, 0.);

		//compute a specular term
		vec3 specularLight = vec3(0., 0., 1.);
		vec3 r = reflect(-L.xyz, N.xyz);
		float cosAlpha = max(dot(r, L.xyz), 0.);
		float k_specular = 1.0;
		vec3 specularColor = k_specular * pow(cosAlpha, 1.) * specularLight;


		//combine their effects
		vec3 color = lambertColor + specularColor;

		gl_FragColor = vec4(color, 1.);
	}


</script>
	<script>
		var container;
		var camera, scene, renderer;
		var uniforms;

		init();
		animate();

		function init() {
			container = document.getElementById('container');

			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
			camera.position.z = 10;


			scene = new THREE.Scene();

			var geometry = new THREE.SphereBufferGeometry(2, 32, 32);

			uniforms = {
				u_time: { type: "f", value: 1.0 },
				u_resolution: { type: "v2", value: new THREE.Vector2() },
				u_mouse: { type: "v2", value: new THREE.Vector2()}
			};

			var material = new THREE.ShaderMaterial({
				uniforms: uniforms,
				vertexShader: document.getElementById('vertexShader').textContent,
				fragmentShader: document.getElementById('fragmentShader').textContent
			});

			//let basic = new THREE.MeshBasicMaterial();

			/** LIGHTS!!! **/
			// let light = new THREE.DirectionalLight(0xffff3f, 0,5);

			// light.position = new THREE.Vector3(1,1,0);
			// scene.add(light);
			// let helper = new THREE.DirectionalLightHelper(light, 5);
			// scene.add(helper);

			var mesh = new THREE.Mesh(geometry, material);
			scene.add(mesh);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);


			container.appendChild(renderer.domElement);

			onWindowResize();
			window.addEventListener('resize', onWindowResize, false);

			document.onmousemove = function (e) {
				uniforms.u_mouse.value.x = e.pageX
				uniforms.u_mouse.value.y = e.pageY
			}
		}

		function onWindowResize(event) {
			renderer.setSize(window.innerWidth, window.innerHeight);
			uniforms.u_resolution.value.x = renderer.domElement.width;
			uniforms.u_resolution.value.y = renderer.domElement.height;
		}

		function animate() {
			requestAnimationFrame(animate);
			render();
		}

		function render() {
			uniforms.u_time.value += 0.05;
			renderer.render(scene, camera);
		}
	</script>
</body>

</html>