<!DOCTYPE html>
<html>

<head>
	<title> Lambertian Shader!</title>
</head>

<body>
	<div id="container"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/106/three.js"></script>
	<script id="vertexShader" type="x-shader/x-vertex">
		varying vec4 globalNorm;
		varying vec4 globalPos;
		void main() {
		globalNorm = modelViewMatrix * (vec4(normal, 0));
		globalPos = modelViewMatrix * vec4(position, 1);
		gl_Position = projectionMatrix * globalPos;
	}
</script>
<script id="fragmentShader" type="x-shader/x-fragment">
	varying vec4 globalNorm;
	varying vec4 globalPos;
	uniform vec3 u_ambient;
	uniform vec3 u_diffuse;
	uniform vec3 u_specular;

	void main(){
	//Lambertian diffuse component
	vec4 N = normalize(globalNorm);
	vec4 L = normalize((vec4(cameraPosition, 1) - globalPos));
	float cosine = dot(N,L);
	float k_lambert = max(cosine, 0.);
	vec3 lightColor = vec3(1., 0., 0.);
	vec3 u_diffuse = k_lambert * lightColor ;

	//add in an ambient color
	vec3 u_ambient = vec3(0., 0.1, 0.);

	//compute a specular term
	vec3 specularLight = vec3(0., 0., 1.);
	vec3 r = reflect(-L.xyz, N.xyz);
	float cosAlpha = max(dot(r, L.xyz), 0.);
	float k_specular = 1.;
	vec3 u_specular = k_specular * pow(cosAlpha, 9.) * specularLight;

	// assume that the material itself has a color
	vec3 material_color = vec3(0.39, 0.26, 0.13);

	//combine their effects
	vec3 color = material_color + u_diffuse + u_specular;
	gl_FragColor = vec4(color, 1.);
}
</script>
<script>
	var container;
	var camera, scene, renderer;
	var uniforms, mesh;
	init();
	animate();
	function init() {
		container = document.getElementById('container');
		camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
		camera.position.z = 10;
		camera.lookAt(0,0,0)
		scene = new THREE.Scene();
		//var geometry = new THREE.SphereBufferGeometry(2, 32, 32);
		var geometry = new THREE.BoxGeometry(2,3,3);
		uniforms = {
			u_time: { type: "f", value: 1.0 },
			u_resolution: { type: "v2", value: new THREE.Vector2() },
			u_mouse: { type: "v2", value: new THREE.Vector2()},
			u_ambient: {type : "v3", value: new THREE.Vector3()},
			u_diffuse: {type : "v3", value: new THREE.Vector3()},
			u_specular: {type : "v3", value: new THREE.Vector3()}
		};
		var material = new THREE.ShaderMaterial({
			uniforms: uniforms,
			vertexShader: document.getElementById('vertexShader').textContent,
			fragmentShader: document.getElementById('fragmentShader').textContent
		});
			//let basic = new THREE.MeshBasicMaterial();
			/** LIGHTS!!! **/
			// let light = new THREE.DirectionalLight(0xffff3f, 0,5);
			// light.position = new THREE.Vector3(1,1,0);
			// scene.add(light);
			// let helper = new THREE.DirectionalLightHelper(light, 5);
			// scene.add(helper);
			mesh = new THREE.Mesh(geometry, material);
			scene.add(mesh);
			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			container.appendChild(renderer.domElement);
			onWindowResize();
			window.addEventListener('resize', onWindowResize, false);
			document.onmousemove = function (e) {
				uniforms.u_mouse.value.x = e.pageX
				uniforms.u_mouse.value.y = e.pageY
			}
		}
		function onWindowResize(event) {
			renderer.setSize(window.innerWidth, window.innerHeight);
			uniforms.u_resolution.value.x = renderer.domElement.width;
			uniforms.u_resolution.value.y = renderer.domElement.height;
		}
		function animate() {
			requestAnimationFrame(animate);
			render();
			mesh.rotation.x += 0.01;
			mesh.rotation.y += 0.01;
		}
		function render() {
			uniforms.u_time.value += 0.05;
			renderer.render(scene, camera);
		}
	</script>
</body>

</html>
